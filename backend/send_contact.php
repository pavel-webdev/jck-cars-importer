<?php
require_once 'config.php';

// –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
session_start();

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 10 —Å–µ–∫—É–Ω–¥)
if (isset($_SESSION['last_submit_time']) && (time() - $_SESSION['last_submit_time']) < 10) {
    echo "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–ª–µ–¥—É—é—â–µ–π –∑–∞—è–≤–∫–∏";
    exit;
}

// –ó–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤ - —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ
if (!empty($_POST['website'])) {
    echo "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã";
    exit;
}

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
    $name = trim($_POST["name"]);
    $email = trim($_POST["email"]);
    $phone = trim($_POST["phone"]);
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏
    if (empty($name)) {
        echo "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è";
        exit;
    }
    if (strlen($name) < 2) {
        echo "–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞";
        exit;
    }
    if (strlen($name) > 50) {
        echo "–ò–º—è –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 50 —Å–∏–º–≤–æ–ª–æ–≤";
        exit;
    }
    if (!preg_match("/^[a-zA-Z–∞-—è–ê-–Ø—ë–Å\s\-]+$/u", $name)) {
        echo "–ò–º—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã";
        exit;
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è email
    if (empty($email)) {
        echo "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à email";
        exit;
    }
    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        echo "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å";
        exit;
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    if (empty($phone)) {
        echo "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω";
        exit;
    }
    
    // –û—á–∏—â–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É
    $clean_phone = preg_replace('/[^\d]/', '', $phone);
    if (strlen($clean_phone) < 10) {
        echo "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Ü–∏—Ñ—Ä";
        exit;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
    $_SESSION['last_submit_time'] = time();
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –±–æ—Ç–∞
    $botToken = "8594694250:AAHcexCSCcuJVoXSF5y3bgfLlQbDVTo_4Y8"; 
    $chatId = "-1003307416810"; 
    
    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    $message = "üöó *–ù–û–í–ê–Ø –ó–ê–Ø–í–ö–ê –ù–ê –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Æ*%0A%0A";
    $message .= "üë§ *–ò–º—è:* " . urlencode($name) . "%0A";
    $message .= "üìß *Email:* " . urlencode($email) . "%0A";
    $message .= "üìû *–¢–µ–ª–µ—Ñ–æ–Ω:* " . urlencode($phone) . "%0A%0A";
    $message .= "üí¨ *–ó–∞–ø—Ä–æ—Å:* –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –ø–æ–¥–±–æ—Ä—É –∞–≤—Ç–æ%0A";
    $message .= "üïí *–í—Ä–µ–º—è:* " . date("d.m.Y H:i:s") . "%0A";
    $message .= "üåê *–ò—Å—Ç–æ—á–Ω–∏–∫:* –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞";
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
    $url = "https://api.telegram.org/bot{$botToken}/sendMessage?chat_id={$chatId}&text={$message}&parse_mode=Markdown";
    
    $response = @file_get_contents($url);
    
    if ($response !== false) {
        $responseData = json_decode($response, true);
        if ($responseData && $responseData['ok']) {
            echo "success";
        } else {
            echo "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏";
        }
    } else {
        echo "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏";
    }
} else {
    echo "–ù–µ–≤–µ—Ä–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–∞";
}
?>